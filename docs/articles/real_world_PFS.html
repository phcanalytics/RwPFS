<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real-world Progression-free Survival (rwPFS) • realworldPFS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Real-world Progression-free Survival (rwPFS)">
<meta property="og:description" content="realworldPFS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">realworldPFS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/real_world_PFS.html">Real-world Progression-free Survival (rwPFS)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.roche.com/RWDScodeshare/realworldPFS/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="real_world_PFS_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Real-world Progression-free Survival (rwPFS)</h1>
                        <h4 class="author">Michael Bretscher</h4>
            
            <h4 class="date">2021-06-29</h4>
      
      
      <div class="hidden name"><code>real_world_PFS.Rmd</code></div>

    </div>

    
    
<p><br></p>
<p>Acknowledgements for supporting the work on rwPFS in one way or another: Robson Machado, Shivani Mhatre, Thanh Ton, Huong Trinh, Jinjoo Shim, Giovanni D’Ario, Francesca Michielin, Venus So, Xing Yang, Prabhu Shanmugasundaram, Kalyan Nandi</p>
<p><br><br></p>
<p><strong>Note that the vignette below is currently written for FlatironKitchen and needs to be updated. FlatironKitchen imports the present <em>realworldPFS</em> package and provides wrappers around <code>add_progression</code>, <code>calc_rwPFS</code> and <code>compare_rwPFS</code> functions, called <code>fi_add_progression</code>, <code>fi_calc_rwPFS</code>, and <code>fi_compare_rwPFS</code>, respectively.</strong></p>
<p>For details on how the use of a <em>realworldPFS</em> function differs from the corresponding <em>FlatironKitchen</em> wrapper please consult <code>?function_name</code>.**</p>
<p><br><br></p>
<p><strong>Feel free to skip the background section if just looking for how to use the software - if conducting an actual analysis, we recommend to read it in order to understand the pitfalls of using rwPFS</strong></p>
<p><br><br></p>
<div id="background-on-rwpfs" class="section level1">
<h1 class="hasAnchor">
<a href="#background-on-rwpfs" class="anchor"></a>Background on rwPFS</h1>
<p>Progression-free Survival (PFS) is a commonly used time-to event endpoint in cancer trials. It is defined as the first event of either death or progression, whichever occurs first.</p>
<p>An important difference between PFS and Overall Survival (OS) endpoints is that PFS requires close follow-up of patients, whereas OS does not. This is because death is a one-time event, and whenever a patient is contacted alive, we know that death had not occurred previously. This is not the case when looking at progression, hence patients must be closely monitored.</p>
<p><br></p>
<p><strong>The mechanisms of data-collection differ between real-world data &amp; clinical trials <span class="citation">(Mhatre 2021)</span>:</strong></p>
<ul>
<li><p>In clinical trials, tumor assessments are commonly scheduled at regular intervals, and progression is assessed using standardized criteria. The reason for collecting PFS data in clinical trials is commonly to measure efficacy. Transparency and consistency of the data collection process is emphasized.</p></li>
<li><p>In routine health care, there is no protocol and hence no scheduled tumor assessments nor standardized criteria for assessing progression. Physicians may primarily measure progression in order to make treatment decisions, not to measure effectiveness. In addition, transparency and consistency of data collection are likely to be less important objectives than cost considerations or minimization of discomfort for the patient (e.g. by avoiding unnecessary scans).</p></li>
</ul>
<p><br></p>
<p>Because of these differences, it appears sensible to speak of “real-world PFS” (<strong>rwPFS</strong>) and to treat it as distinct from trial PFS.</p>
<p>However, due to the highly similar definitions of rwPFS and PFS, it is possible that the two endpoints may be <em>exchangeable</em>, meaning they essentially lead to the same result and could be used to compare effectivness of treatments both within a particular real-world data source as well as between trial and real-world data.</p>
<p><br></p>
<blockquote>
<p>Whether or not <strong>PFS</strong> and <strong>rwPFS</strong> endpoints are <strong>exchangeable</strong> and can be used for comparing drug efficacy across two data sets (real-world and clinical trial) may depend on indication, drug category, real-world database, and other factors. While attempts should be made to understand and ensure quality of data collection in the real-world data, this will likely never be perfect. Consequently, empirical confirmation of exchangeability of rwPFS and PFS will be needed. This can be done by replicating trial arms and comparing rwPFS and trial PFS outcomes <span class="citation">(Mhatre 2021; Ton 2021)</span>, across indications and drug categories.</p>
</blockquote>
<p><br></p>
<div id="publications-assessing-exchangeability-of-rwpfs-and-trial-pfs" class="section level2">
<h2 class="hasAnchor">
<a href="#publications-assessing-exchangeability-of-rwpfs-and-trial-pfs" class="anchor"></a>Publications assessing exchangeability of rwPFS and trial PFS</h2>
<p>The following publications assess exchangeability of rwPFS and PFS:</p>
<ul>
<li><p><span class="citation">Ton (2021)</span> : aNSCLC chemotherapy</p></li>
<li><p><span class="citation">Mhatre (2021)</span> (in preparation): aNSCLC chemotherapy and immunotherapy</p></li>
</ul>
<p>Please help complete this list by <a href="https://github.roche.com/RWDScodeshare/FlatironKitchen/issues/new">suggesting additional articles</a></p>
</div>
<div id="algorithm-for-calculating-rwpfs-using-flatiron-data" class="section level2">
<h2 class="hasAnchor">
<a href="#algorithm-for-calculating-rwpfs-using-flatiron-data" class="anchor"></a>Algorithm for calculating rwPFS using Flatiron data</h2>
<p>The schematic below illustrates the important elements required for calculating a rwPFS endpoint:</p>
<ul>
<li><p>the start date (baseline)</p></li>
<li><p>‘lastclinicnotedate,’ the date up to which progression was abstracted from clinical notes</p></li>
<li><p>the dates of any progression events of interest (may be a subset of events)</p></li>
<li><p>the date of death, if present</p></li>
<li><p>the date of a patient’s last structured activity in the database</p></li>
<li><p>the presence of potential visit gaps (not shown), indicating that the patient may not have been followed for progression due to prolonged absence from the clinic in the Flatiron network (e.g. &gt;90d).</p></li>
<li><p>a time window after the end of progression follow-up where death events are to be captured. This is required because patients often leave the Flatiron network shortly before dying. If the time window is too small, there will almost exclusively be progression events. If the window is too large, more deaths are captured, but at the same time the risk of missing any progression events increases. Therefore, a pragmatic choice in the middle will have to be made. More on this point later.</p></li>
</ul>
<p><br><br></p>
<p><img src="https://github.roche.com/RWDScodeshare/FlatironKitchen/blob/rwPFS_MichaelB/inst/img/schema_real_world_pfs.png?raw=true" width="115%" style="display: block; margin: auto auto auto 0;"></p>
<p><br><br></p>
<blockquote>
<p><strong>A general algorithm for calculation of rwPFS consists of the following steps:</strong></p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Determine the period of continuous progression follow-up.</strong></p>
<p>It begins at baseline and ends at one of the following, whichever occurs first:</p>
<ul>
<li><p>the start of a long gap between visits (e.g. &gt;90d)</p></li>
<li><p>the date of last progression abstraction (‘lastclinicnotedate’)</p></li>
<li><p>the date of last structured activity in the database</p></li>
</ul>
</li>
<li>
<p><strong>Determine the type of rwPFS event</strong>, in this order:</p>
<ul>
<li><p>“Progression,” if an event occurs during the follow-up period</p></li>
<li><p>“Death,” if it occurs within the specified time window after end of follow-up</p></li>
<li><p>“Censoring” otherwise</p></li>
</ul>
</li>
<li>
<p><strong>Create rwPFS variables </strong></p>
<ul>
<li><p>record a rwPFS event in case of death or progression event types</p></li>
<li><p>otherwise, censor the patient at the end of progression follow-up</p></li>
<li><p>calculate the time from baseline to event or censoring</p></li>
</ul>
</li>
</ol>
</blockquote>
</div>
<div id="there-are-several-possible-rwpfs-definitions" class="section level2">
<h2 class="hasAnchor">
<a href="#there-are-several-possible-rwpfs-definitions" class="anchor"></a>There are several possible rwPFS definitions</h2>
<p><strong>Multiple possible definitions of rwPFS can be specified based on the elements mentioned above:</strong></p>
<ul>
<li><p><strong>different subsets of progression events in Flatiron’s <em>progression</em> table could be used</strong>, e.g. only radiographically confirmed progression events, or only progression events that occur more than 14 days after baseline (as per Flatiron recommendation)</p></li>
<li>
<p><strong>different possibilities exist to handle changes in the line of therapy (LoT):</strong> one could either</p>
<ul>
<li><p>follow the patient for progression into a subsequent LoT if no progression has occurred, or..</p></li>
<li><p>censor the patient at the start of a subsequent LoT, or..</p></li>
<li><p>impute a progression event at the start of a subsequent LoT (following the clinical logic that LoT is anchored to progression)</p></li>
</ul>
</li>
<li>
<p><strong>different choices are possible for the length of the time window to capture death events</strong></p>
<ul>
<li><p>the aim is to capture most of - and only - the death events correlated in time with the end of follow-up.</p></li>
<li><p>this is reminiscent of informative censoring - except events after the <em>end of follow-up</em> can be assessed and potentially included.</p></li>
<li><p>reasonable values for the length of the time window can be argued based on comparison with data collection in trials, or - in a data-driven way - by inspecting the drop in death events as the window is being extended (see best practices below). For a detailed discussion see <span class="citation">Mhatre (2021)</span></p></li>
<li><p>ultimately, any choice will remain arbitrary to some extent.</p></li>
</ul>
</li>
<li><p>it seems reasonable to ensure gapless progression follow-up, but <strong>the choice of a maximally tolerable gap length between visits remains arbitrary</strong>. A commonly used value is 90 days, however, without a very strong rationale.</p></li>
</ul>
</div>
<div id="best-practices-to-support-the-emergence-of-consensus-definitions" class="section level2">
<h2 class="hasAnchor">
<a href="#best-practices-to-support-the-emergence-of-consensus-definitions" class="anchor"></a>Best practices to support the emergence of consensus definitions</h2>
<p>As outlined above, there is a range of possible definitions of rwPFS. To determine which of these are most closely mimicking clinical trial PFS requires discussions with subject matter experts, and it is possible that different conclusions may be reached depending on cancer type, indication, drug category, analysis objective, or other factors. From our experience in aNSCLC <span class="citation">(Mhatre 2021; Ton 2021)</span> several definitions - not only one - remain viable options even after discussion with experts, and eventually a pragmatic choice must be made. Despite a desire for standardization, we reached the conclusion that defining a single standard is not helpful given the current state of knowledge, and that instead we should promote best practices that support the emergence of - preferably rather few - standard definitions via publications in the scientific literature.</p>
<p><br></p>
<p>To promote the emergence of standard rwPFS definitions and comparability across analyses we propose the following best practices: <br><br></p>
<blockquote>
<p><strong>Proposed best practices when using rwPFS</strong></p>
<ol style="list-style-type: decimal">
<li><p>Check if there is already a commonly used rwPFS definition in analyses similar to yours.</p></li>
<li><p>Discuss sensible rwPFS definitions with subject matter experts.</p></li>
<li><p>If there is already a commonly used rwPFS definition that passes the expert test, try to use it.</p></li>
<li><p>If you have reasons to use a different definition, do so and try to explain your choice</p></li>
<li><p><strong>Be transparent about the exact definition you’re using</strong></p></li>
<li><p><strong>Explore a range of sensible alternative definitions and report key descriptors to show how rwPFS definition affects the conclusions of the analysis</strong></p></li>
</ol>
</blockquote>
<p><br><br></p>
</div>
</div>
<div id="the-basics-adding-rwpfs" class="section level1">
<h1 class="hasAnchor">
<a href="#the-basics-adding-rwpfs" class="anchor"></a>The basics: adding rwPFS</h1>
<p>To start, we will add a rwPFS variable to our FlatironKitchen dataset. For simplicity, we will use the rwPFS definition used in <span class="citation">Mhatre (2021)</span> and <span class="citation">Ton (2021)</span>:</p>
<ul>
<li><p><strong>Use all progression events except where “pseudoprogression mentioned”</strong> (not only events based on radiographic evidence, and we don’t discard progression events occurring within 2 weeks after baseline)</p></li>
<li><p><strong>Follow patients for progression into subsequent lines of treatment</strong> (do not censor them at start of new line, do not impute progression at line change)</p></li>
<li><p><strong>Include death events occurring &lt;30d after end of progression follow-up</strong></p></li>
<li><p><strong>Censor individuals if there is a visit gap &gt; 90 days during follow-up</strong></p></li>
<li><p><strong>Use the first progression event when there are several</strong></p></li>
</ul>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<ol style="list-style-type: decimal">
<li>Load the required libraries</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://go.roche.com/FlatironKitchen">FlatironKitchen</a></span><span class="op">)</span></code></pre></div>
<p>Here is the version of <code>FlatironKitchen</code> used in this vignette.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"FlatironKitchen"</span><span class="op">)</span>
<span class="co">#&gt; [1] '1.0.8'</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Create a FlatironKitchen object, using the advanced Non Small-cell Lung Cancer datamart</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_start.html">fi_start</a></span><span class="op">(</span>
  datamart <span class="op">=</span> <span class="st">"AdvancedNSCLC"</span>,
  title <span class="op">=</span> <span class="st">"rwPFS in aNSCLC"</span>
<span class="op">)</span> </code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Add information on the 1st line of therapy (note we’re also getting info on the 2nd line for later..)</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">&lt;-</span> <span class="va">fk</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_add_lineoftherapy_flatiron.html">fi_add_lineoftherapy_flatiron</a></span><span class="op">(</span>
    lines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,
    index_date <span class="op">=</span> <span class="st">"advanceddiagnosisdate"</span>,
    left <span class="op">=</span> <span class="fl">0</span>,
    right <span class="op">=</span> <span class="fl">90</span>,
    calc_duration <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span> </code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>We will look at the rwPFS in patients that receive Carboplatin &amp; Paclitaxel in first line</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">&lt;-</span> <span class="va">fk</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_cohort_include.html">fi_cohort_include</a></span><span class="op">(</span>
    <span class="va">lot1linename</span> <span class="op">==</span> <span class="st">"Carboplatin,Paclitaxel"</span>, 
    description <span class="op">=</span> <span class="st">"Carboplatin &amp; Paclitaxel in 1st line"</span>, 
    keep_na <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span> </code></pre></div>
<p>Let’s a have a quick look at the cohort we’ve just selected:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fk</span><span class="op">)</span>
<span class="co">#&gt; Project </span>
<span class="co">#&gt; $title          :  rwPFS in aNSCLC </span>
<span class="co">#&gt; $datamart       :  AdvancedNSCLC </span>
<span class="co">#&gt; $version        :  1.0.8 'Tiramisu'</span>
<span class="co">#&gt; $year_month     :  2021_05 'May 2021'</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Patients </span>
<span class="co">#&gt; $n              :  7,907 Patients </span>
<span class="co">#&gt; $col_names      :  34 [..., lot2startdate, lot2enddate]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attrition </span>
<span class="co">#&gt; AdvancedNSCLC                       :  69,869 ----------------------------------------</span>
<span class="co">#&gt; Carboplatin &amp; Paclitaxel in 1st lin :   7,907 ----</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Warnings </span>
<span class="co">#&gt; -  508 (0.7%) patients appear in at least one other enhanced cohort. </span>
<span class="co">#&gt; -  16 (0%) patient(s) had DateOfDeath values unlike YYYY-MM and will b...</span></code></pre></div>
<p>These are the variables we currently have in our data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> <span class="va">names</span>
<span class="co">#&gt;  [1] "patientid"             "diagnosisdate"         "advanceddiagnosisdate"</span>
<span class="co">#&gt;  [4] "histology"             "groupstage"            "smokingstatus"        </span>
<span class="co">#&gt;  [7] "multiple"              "practiceid"            "practicetype"         </span>
<span class="co">#&gt; [10] "primaryphysicianid"    "birthyear"             "gender"               </span>
<span class="co">#&gt; [13] "race"                  "ethnicity"             "state"                </span>
<span class="co">#&gt; [16] "region"                "raceethnicity"         "dateofdeath"          </span>
<span class="co">#&gt; [19] "death"                 "lastvisitdate"         "lastadmindate"        </span>
<span class="co">#&gt; [22] "lastlabdate"           "lastvitalsdate"        "enddate"              </span>
<span class="co">#&gt; [25] "lastactivitydate"      "lastcontactdate"       "lot1linename"         </span>
<span class="co">#&gt; [28] "lot1linecategory"      "lot1startdate"         "lot1enddate"          </span>
<span class="co">#&gt; [31] "lot2linename"          "lot2linecategory"      "lot2startdate"        </span>
<span class="co">#&gt; [34] "lot2enddate"</span></code></pre></div>
<p>Note that several variables required for the calculation of rwPFS are already present.</p>
<p>These are “lot1startdate” (our baseline), lastactivitydate and dateofdeath.</p>
<p>What’s still missing for the calculation of rwPFS (besides progression), is information on any long gaps between visits, so let’s do this</p>
<ol start="5" style="list-style-type: decimal">
<li>Add information on visit gaps larger than 90 days from start of 1st line onwards</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">&lt;-</span> <span class="va">fk</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_visitgap.html">fi_calc_visitgap</a></span><span class="op">(</span>
    index_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,
    gapdays <span class="op">=</span> <span class="fl">90</span>,
    what <span class="op">=</span> <span class="st">"After"</span>,
    force_database <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span></code></pre></div>
<p>This is required to ensure gapless progression follow-up. The function added a few columns related to the visit gap, of which we only need the date of the “lastvisitbeforegap.”</p>
</div>
<div id="add-information-on-progression" class="section level2">
<h2 class="hasAnchor">
<a href="#add-information-on-progression" class="anchor"></a>Add information on progression</h2>
<ol start="6" style="list-style-type: decimal">
<li>add the date of the first progression event and end date of progression abstraction (“lastclinicnotedate”)</li>
</ol>
<p>Selecting the subset of progression events to use is the first step of specifying a rwPFS definition. Here we stick to the definition outlined above, using all progression events, radiographic or not, and we don’t discard any events occuring right after baseline. We do exclude events that are flagged “ispseudoprogressionmentioned,” though. Incidentally, there won’t be any pseudoprogression events in chemotherapies such as the Carboplatin &amp; Paclitaxel combination (you could check the number of events to verify). Here we’re simply sticking to the definition proposed by <span class="citation">Mhatre (2021)</span> for use across both CIT and chemotherapies in aNSCLC, based on the OAK trial (see <span class="citation">Mhatre (2021)</span> for details).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">&lt;-</span> <span class="va">fk</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_add_progression.html">fi_add_progression</a></span><span class="op">(</span>
      start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,          <span class="co">#we're measuring rwPFS from the start of treatment</span>
      require_radiographic <span class="op">=</span> <span class="cn">FALSE</span>,          <span class="co">#we don't require progression to be radiographically confirmed (in NSCLC, most are anyway)</span>
      exclude_pseudoprogression <span class="op">=</span> <span class="cn">TRUE</span>,      <span class="co">#we exclude pseudoprogression events (there won't be any in our chemo treatment)</span>
      discard_n_days <span class="op">=</span> <span class="fl">0</span>,                    <span class="co">#we do not discard any progression events right after baseline              </span>
      label <span class="op">=</span> <span class="st">"_nopseudo"</span>,                   <span class="co">#this (optional) label will help us keep different rwPFS endpoints apart later</span>
      prog_filter_expression <span class="op">=</span> <span class="cn">NULL</span>          <span class="co">#this is an advanced feature allowing more flexible event selection, explained later. Defaults to NULL.</span>
  <span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_progression() ────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first progression event after lot1startdate, discarding events within the first 0 days. Require_radiographic: FALSE. Exclude_pseudoprogression: TRUE. Label: "_nopseudo". Expression for additional filtering of progression events: none.</span>
<span class="co">#&gt; Touching: ENHANCED_ADVNSCLCPROGRESSION</span>
<span class="co">#&gt; Joining, by = "patientid"</span>
<span class="co">#&gt; Warning : 292 patient(s) had no progression information abstracted beyond startdate (lastclinicnotedate set to missing)</span>
<span class="co">#&gt; NewCols : progressiondate_nopseudo, lastclinicnotedate_nopseudo</span>
<span class="co">#&gt; Time    : 7.5s [56.8 s]</span></code></pre></div>
<p>Two new columns were added: <em>progressiondate_nopseudo</em> and <em>lastclinicnotedate_nopseudo</em></p>
<p>Note that FlatironKitchen warned us that 287 out of our 7,823 patients had no progression abstracted beyond the baseline date. This can happen if patients had no progression information abstracted at all, or their lastclinicnotedate is before our startdate. At this point we could exclude those patients since it won’t be possible to calculate rwPFS for them. However, let’s leave them for now, in order to demonstrate how the downstream functions deal with such cases.</p>
</div>
<div id="habemus-real-world-pfs" class="section level2">
<h2 class="hasAnchor">
<a href="#habemus-real-world-pfs" class="anchor"></a>Habemus real-world PFS!</h2>
<p>Not yet - but soon. Now that all required columns are present in our dataset, we can..</p>
<ol start="7" style="list-style-type: decimal">
<li>Compute the rwPFS endpoint</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">fk</span> <span class="op">&lt;-</span> <span class="va">fk</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          <span class="co">#we're measuring rwPFS from the start of treatment</span>
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           <span class="co">#the start date of any gap in visits longer than 90 days</span>
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>, <span class="co">#the lastclinicnotedate we just added..</span>
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,         <span class="co">#..and the progression date with the same label</span>
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               <span class="co">#the date of last activity in the database</span>
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">30</span>,                                <span class="co">#include death events up to 30d after end of progression follow-up</span>
    max_follow_up_days <span class="op">=</span> <span class="cn">Inf</span>,                              <span class="co">#censor patients after a maximum time (e.g. to harmonize with the trial). Defaults to Inf.</span>
    label <span class="op">=</span> <span class="st">"_no_pseudoprogression"</span>                        <span class="co">#let this be our primary rwPFS definition, the reference to compare others against</span>
  <span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 30d after end of progression follow-up. Label: _no_pseudoprogression.</span>
<span class="co">#&gt; Warning : The rwPFS variables for  377 patient(s) were set to missing. This could be due to one of the following reasons: missing lastclinicnotedate, missing date of last activity,  lastclinicnotedate equal to the startdate, or a date of death being earlier than the start date (this can happen because death dates are rounded to mid-month in Flatiron).  These could be either removed from the data, or manually censored at baseline (to preserve the distribution of baseline covariates)</span>
<span class="co">#&gt; NewCols : rwpfs_no_pseudoprogression_eof_date, rwpfs_no_pseudoprogression_event_type, rwpfs_no_pseudoprogression_date, rwpfs_no_pseudoprogression_days, rwpfs_no_pseudoprogression_event, rwpfs_no_pseudoprogression_months</span>
<span class="co">#&gt; Time    : 0.1s [56.9 s]</span></code></pre></div>
<p>Note the warning about some patients having been set to missing. Let’s have a closer look at those.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">rwpfs_no_pseudoprogression_event_type</span> <span class="op">==</span> <span class="st">"Missing"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span>
    `missing lastclinicnotedate` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">lastclinicnotedate_nopseudo</span><span class="op">)</span>, 
    `lastclinicnotedate on start date?` <span class="op">=</span> <span class="va">lot1startdate</span> <span class="op">==</span> <span class="va">lastclinicnotedate_nopseudo</span>,
    `missing last activity date?` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">lastactivitydate</span><span class="op">)</span>,
    `death before start date` <span class="op">=</span> <span class="va">dateofdeath</span> <span class="op">&lt;=</span> <span class="va">lot1startdate</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<table class="table">
<colgroup>
<col width="23%">
<col width="29%">
<col width="23%">
<col width="20%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="left">missing lastclinicnotedate</th>
<th align="left">lastclinicnotedate on start date?</th>
<th align="left">missing last activity date?</th>
<th align="left">death before start date</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">55</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">NA</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">202</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">26</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="left">NA</td>
<td align="right">64</td>
</tr>
</tbody>
</table>
<p>It looks like a total of 278 patients had a missing lastclinicnote date (this may have been so from the start, or fi_add_progression may have set this to missing in case it was before the start date). The fi_add_progression function had already alerted us about this. An additional 17 patients seem to have their death dates before start date, which is likely due to the monthly granularity of death dates in Flatiron (for de-identification purposes). Let us remove patients with missing rwPFS.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">&lt;-</span> <span class="va">fk</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_cohort_exclude.html">fi_cohort_exclude</a></span><span class="op">(</span><span class="va">rwPFS_no_pseudoprogression_event_type</span> <span class="op">==</span> <span class="st">"Missing"</span>,
                    description <span class="op">=</span> <span class="st">"Exclude missing rwPFS"</span>,
                    keep_na <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_cohort_exclude() ─────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Description = Exclude missing rwPFS</span>
<span class="co">#&gt; Note    : Code = rwPFS_no_pseudoprogression_event_type == "Missing"</span>
<span class="co">#&gt; Excluded: 377 patients</span>
<span class="co">#&gt; Cohort  : 7,530 patients</span>
<span class="co">#&gt; Time    : 0s [56.9 s]</span></code></pre></div>
<p>Finally, let’s plot the Kaplan-Meier curve for rwPFS, stratified by histology.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_stat_survfit.html">fi_stat_survfit</a></span><span class="op">(</span>
    followup_duration <span class="op">=</span> <span class="st">"rwpfs_no_pseudoprogression_months"</span>,
    status <span class="op">=</span> <span class="st">"rwpfs_no_pseudoprogression_event"</span>,
    strata <span class="op">=</span> <span class="st">"histology"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_plot_km.html">fi_plot_km</a></span><span class="op">(</span>
    xlab <span class="op">=</span> <span class="st">"Months"</span>
  <span class="op">)</span></code></pre></div>
<p><img src="real_world_PFS_files/figure-html/unnamed-chunk-14-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>This doesn’t look too bad - except that the different histologies have very different follow-up times, it seems. Let’s re-generate those rwPFS variables, but this time right-censor patients with respect to rwPFS at around 40 months - let’s say 1200 days.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">&lt;-</span> <span class="va">fk</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_select.html">fi_select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"rwpfs"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>                        <span class="co">#FK doesn't let us overwrite columns, lots remove the old ones first.. </span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>, 
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,        
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">30</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_no_pseudoprogression"</span>                                  
  <span class="op">)</span> 
<span class="co">#&gt; Time    : 0s [56.9 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 30d after end of progression follow-up. Label: _no_pseudoprogression.</span>
<span class="co">#&gt; NewCols : rwpfs_no_pseudoprogression_eof_date, rwpfs_no_pseudoprogression_event_type, rwpfs_no_pseudoprogression_date, rwpfs_no_pseudoprogression_days, rwpfs_no_pseudoprogression_event, rwpfs_no_pseudoprogression_months</span>
<span class="co">#&gt; Time    : 0s [57 s]</span></code></pre></div>
<p>..and plot it again</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_stat_survfit.html">fi_stat_survfit</a></span><span class="op">(</span>
    followup_duration <span class="op">=</span> <span class="st">"rwpfs_no_pseudoprogression_months"</span>,
    status <span class="op">=</span> <span class="st">"rwpfs_no_pseudoprogression_event"</span>,
    strata <span class="op">=</span> <span class="st">"histology"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_plot_km.html">fi_plot_km</a></span><span class="op">(</span>
    xlab <span class="op">=</span> <span class="st">"Months"</span>
  <span class="op">)</span></code></pre></div>
<p><img src="real_world_PFS_files/figure-html/unnamed-chunk-16-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>This looks much cleaner. Congratulations, you’ve mastered the basics of using rwPFS!</p>
<p><br><br></p>
</div>
</div>
<div id="advanced-comparison-of-multiple-rwpfs-definitions" class="section level1">
<h1 class="hasAnchor">
<a href="#advanced-comparison-of-multiple-rwpfs-definitions" class="anchor"></a>Advanced: comparison of multiple rwPFS definitions</h1>
<p>As mentioned before, there is more than one way of defining rwPFS. Often, the differences between definitions will be small - but nevertheless, we need to show this, we can’t just assume they are, and we must be able to answer questions in that direction.. However, conducting a full sensitivity analysis for each and every rwPFS definition seems overkill.. so what do we do?</p>
<p><br></p>
<p>Ideally, we’d have a concise summary table, where readers could verify at one glance what the impact of varying the endpoint definition would be. This is what we’ll try to do..</p>
<p><br></p>
<p>First, let’s calculate rwPFS across a range of “reasonable” definitions, starting with the progression part &amp; varying one aspect at a time, always comparing against our reference progression variable defined previously.</p>
<p><br></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">&lt;-</span> <span class="va">fk</span> <span class="op">%&gt;%</span>
  
  <span class="co">#do not remove pseudoprogression events</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_add_progression.html">fi_add_progression</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,          
    require_radiographic <span class="op">=</span> <span class="cn">FALSE</span>,          <span class="co">#we don't require progression to be radiographically confirmed (in NSCLC, most are anyway)</span>
    exclude_pseudoprogression <span class="op">=</span> <span class="cn">FALSE</span>,     <span class="co">#we don't exclude pseudoprogression events (there won't be any in our chemo treatment)</span>
    discard_n_days <span class="op">=</span> <span class="fl">0</span>,                    <span class="co">#we do not discard any progression events right after baseline              </span>
    label <span class="op">=</span> <span class="st">"_allevents"</span>,                  
    prog_filter_expression <span class="op">=</span> <span class="cn">NULL</span>          
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co">#omit progression events occurring within 14d of baseline (Flatiron guidance)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_add_progression.html">fi_add_progression</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,          
    require_radiographic <span class="op">=</span> <span class="cn">FALSE</span>,          <span class="co">#we don't require progression to be radiographically confirmed (in NSCLC, most are anyway)</span>
    exclude_pseudoprogression <span class="op">=</span> <span class="cn">TRUE</span>,      <span class="co">#we exclude pseudoprogression events (there won't be any in our chemo treatment)</span>
    discard_n_days <span class="op">=</span> <span class="fl">14</span>,                   <span class="co">#we discard any progression events within 14d after baseline              </span>
    label <span class="op">=</span> <span class="st">"_omit_le_14d"</span>,                
    prog_filter_expression <span class="op">=</span> <span class="cn">NULL</span>         
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co">#only use radiographically confirmed progression events</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_add_progression.html">fi_add_progression</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,          
    require_radiographic <span class="op">=</span> <span class="cn">TRUE</span>,           <span class="co">#we require progression to be radiographically confirmed (in NSCLC, most are anyway)</span>
    exclude_pseudoprogression <span class="op">=</span> <span class="cn">TRUE</span>,      <span class="co">#we exclude pseudoprogression events (there won't be any in our chemo treatment)</span>
    discard_n_days <span class="op">=</span> <span class="fl">0</span>,                    <span class="co">#we don't discard progression events shortly after baseline              </span>
    label <span class="op">=</span> <span class="st">"_only_radiographic"</span>,          
    prog_filter_expression <span class="op">=</span> <span class="cn">NULL</span>   
  <span class="op">)</span> 
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_progression() ────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first progression event after lot1startdate, discarding events within the first 0 days. Require_radiographic: FALSE. Exclude_pseudoprogression: FALSE. Label: "_allevents". Expression for additional filtering of progression events: none.</span>
<span class="co">#&gt; Touching: ENHANCED_ADVNSCLCPROGRESSION</span>
<span class="co">#&gt; Joining, by = "patientid"</span>
<span class="co">#&gt; NewCols : progressiondate_allevents, lastclinicnotedate_allevents</span>
<span class="co">#&gt; Time    : 7.8s [64.8 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_progression() ────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first progression event after lot1startdate, discarding events within the first 14 days. Require_radiographic: FALSE. Exclude_pseudoprogression: TRUE. Label: "_omit_le_14d". Expression for additional filtering of progression events: none.</span>
<span class="co">#&gt; Touching: ENHANCED_ADVNSCLCPROGRESSION</span>
<span class="co">#&gt; Joining, by = "patientid"</span>
<span class="co">#&gt; NewCols : progressiondate_omit_le_14d, lastclinicnotedate_omit_le_14d</span>
<span class="co">#&gt; Time    : 8.1s [72.9 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_progression() ────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first progression event after lot1startdate, discarding events within the first 0 days. Require_radiographic: TRUE. Exclude_pseudoprogression: TRUE. Label: "_only_radiographic". Expression for additional filtering of progression events: none.</span>
<span class="co">#&gt; Touching: ENHANCED_ADVNSCLCPROGRESSION</span>
<span class="co">#&gt; Joining, by = "patientid"</span>
<span class="co">#&gt; NewCols : progressiondate_only_radiographic, lastclinicnotedate_only_radiographic</span>
<span class="co">#&gt; Time    : 6.9s [79.7 s]</span></code></pre></div>
<p><br></p>
<p>We also want to look at rwPFS definitions where</p>
<ul>
<li><p>a progression event is imputed at the start of the next LoT</p></li>
<li><p>patients are censored at start of the next Lot</p></li>
<li><p>we don’t consider visit gaps</p></li>
</ul>
<p><br></p>
<p>We already have the start date of the 2nd LoT from before. What we need is the date of those imputed progression events, and a columns that replaces the lastclinicnotedate with the start date of LoT 2 if it’s before lastclinicnotedate..</p>
<p><br></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">&lt;-</span> <span class="va">fk</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_mutate.html">fi_mutate</a></span><span class="op">(</span>
    <span class="co">#impute progression at start of 2nd line</span>
    imputed_progression_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">progressiondate_nopseudo</span>, <span class="va">lot2startdate</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
    <span class="co">#censor at the earliest of lastclinicnotedate or start of 2nd line</span>
    imputed_censoring_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">lastclinicnotedate_nopseudo</span>, <span class="va">lot2startdate</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
    <span class="co">#adding an all_na column because fi_calc_rwPFS expects the start date of any long visit gaps - we'll tell it there are none..</span>
    all_na <span class="op">=</span> <span class="cn">NA_character_</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span>
<span class="co">#&gt; NewCols : imputed_progression_date, imputed_censoring_date, all_na</span>
<span class="co">#&gt; Time    : 0s [79.8 s]</span></code></pre></div>
<p><br></p>
<p>Now, we can calculate the different rwPFS endpoints corresponding to the above handling of progression events and LoT:</p>
<p><br></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">&lt;-</span> <span class="va">fk</span> <span class="op">%&gt;%</span> 
  
   <span class="co">#all events</span>
   <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                           
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,            
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_allevents"</span>,
    progression_date <span class="op">=</span> <span class="st">"progressiondate_allevents"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">30</span>,                                 
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                              
    label <span class="op">=</span> <span class="st">"_all_events"</span>                                   
  <span class="op">)</span>  <span class="op">%&gt;%</span>
  
  <span class="co">#omit events within 14d of baseline</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,          
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_omit_le_14d"</span>, 
    progression_date <span class="op">=</span> <span class="st">"progressiondate_omit_le_14d"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">30</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_omit_le_14d"</span>                                
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co">#only use radiographically confirmed progression events</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_only_radiographic"</span>, 
    progression_date <span class="op">=</span> <span class="st">"progressiondate_only_radiographic"</span>, 
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">30</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_only_radiographic"</span>                           
  <span class="op">)</span>   <span class="op">%&gt;%</span>
  
  <span class="co">#impute progression at start of 2nd line</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>, 
    progression_date <span class="op">=</span> <span class="st">"imputed_progression_date"</span>,        
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">30</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_impute_progression"</span>                          
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co">#censor at the earliest of lastclinicnotedate or start of 2nd line</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"imputed_censoring_date"</span>,      
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">30</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_censor_at_lot_change"</span>                        
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co">#Ignore visit gaps</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"all_na"</span>,                       
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>, 
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,        
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">30</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_ignore_visit_gaps"</span>                           
  <span class="op">)</span> 
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 30d after end of progression follow-up. Label: _all_events.</span>
<span class="co">#&gt; NewCols : rwpfs_all_events_eof_date, rwpfs_all_events_event_type, rwpfs_all_events_date, rwpfs_all_events_days, rwpfs_all_events_event, rwpfs_all_events_months</span>
<span class="co">#&gt; Time    : 0.1s [79.8 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 30d after end of progression follow-up. Label: _omit_le_14d.</span>
<span class="co">#&gt; NewCols : rwpfs_omit_le_14d_eof_date, rwpfs_omit_le_14d_event_type, rwpfs_omit_le_14d_date, rwpfs_omit_le_14d_days, rwpfs_omit_le_14d_event, rwpfs_omit_le_14d_months</span>
<span class="co">#&gt; Time    : 0.1s [79.9 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 30d after end of progression follow-up. Label: _only_radiographic.</span>
<span class="co">#&gt; NewCols : rwpfs_only_radiographic_eof_date, rwpfs_only_radiographic_event_type, rwpfs_only_radiographic_date, rwpfs_only_radiographic_days, rwpfs_only_radiographic_event, rwpfs_only_radiographic_months</span>
<span class="co">#&gt; Time    : 0.1s [79.9 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 30d after end of progression follow-up. Label: _impute_progression.</span>
<span class="co">#&gt; NewCols : rwpfs_impute_progression_eof_date, rwpfs_impute_progression_event_type, rwpfs_impute_progression_date, rwpfs_impute_progression_days, rwpfs_impute_progression_event, rwpfs_impute_progression_months</span>
<span class="co">#&gt; Time    : 0.1s [80 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 30d after end of progression follow-up. Label: _censor_at_lot_change.</span>
<span class="co">#&gt; NewCols : rwpfs_censor_at_lot_change_eof_date, rwpfs_censor_at_lot_change_event_type, rwpfs_censor_at_lot_change_date, rwpfs_censor_at_lot_change_days, rwpfs_censor_at_lot_change_event, rwpfs_censor_at_lot_change_months</span>
<span class="co">#&gt; Time    : 0s [80.1 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 30d after end of progression follow-up. Label: _ignore_visit_gaps.</span>
<span class="co">#&gt; NewCols : rwpfs_ignore_visit_gaps_eof_date, rwpfs_ignore_visit_gaps_event_type, rwpfs_ignore_visit_gaps_date, rwpfs_ignore_visit_gaps_days, rwpfs_ignore_visit_gaps_event, rwpfs_ignore_visit_gaps_months</span>
<span class="co">#&gt; Time    : 0s [80.1 s]</span></code></pre></div>
<p><br></p>
<p>Now that we have all these different rwPFS endpoints, let’s compare them using <code>fi_compare_rwPFS</code>:</p>
<p><br></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">fk</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_compare_rwPFS.html">fi_compare_rwPFS</a></span><span class="op">(</span>
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>                         <span class="co">#Specify the rwPFS labels to be tabulated (in the desired order)</span>
      <span class="st">"_no_pseudoprogression"</span>,
      <span class="st">"_all_events"</span>,
      <span class="st">"_omit_le_14d"</span>,
      <span class="st">"_only_radiographic"</span>,
      <span class="st">"_impute_progression"</span>,
      <span class="st">"_censor_at_lot_change"</span>,
      <span class="st">"_ignore_visit_gaps"</span>
    <span class="op">)</span>,
    reference <span class="op">=</span> <span class="st">"_no_pseudoprogression"</span>,
    incremental_deaths_column <span class="op">=</span> <span class="cn">FALSE</span> 
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_compare_rwpfs() ──────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Comparing rwPFS definitions with the following labels: _no_pseudoprogression, _all_events, _omit_le_14d, _only_radiographic, _impute_progression, _censor_at_lot_change, _ignore_visit_gaps</span>
<span class="co">#&gt; Warning: `select_()` was deprecated in dplyr 0.7.0.</span>
<span class="co">#&gt; Please use `select()` instead.</span></code></pre></div>
<table class="table">
<colgroup>
<col width="21%">
<col width="10%">
<col width="12%">
<col width="6%">
<col width="14%">
<col width="17%">
<col width="17%">
</colgroup>
<thead><tr class="header">
<th align="left">rwPFS definition</th>
<th align="right">Censoring</th>
<th align="right">Progression</th>
<th align="right">Death</th>
<th align="right">Percent death</th>
<th align="left">KM median</th>
<th align="left">Hazard ratio</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">No pseudoprogression</td>
<td align="right">3114</td>
<td align="right">3343</td>
<td align="right">1073</td>
<td align="right">24.3</td>
<td align="left">6.41 (6.18-6.6)</td>
<td align="left">1 (reference)</td>
</tr>
<tr class="even">
<td align="left">All events</td>
<td align="right">3102</td>
<td align="right">3360</td>
<td align="right">1068</td>
<td align="right">24.1</td>
<td align="left">6.34 (6.18-6.57)</td>
<td align="left">1.01 (0.96-1.05)</td>
</tr>
<tr class="odd">
<td align="left">Omit le 14d</td>
<td align="right">3132</td>
<td align="right">3310</td>
<td align="right">1088</td>
<td align="right">24.7</td>
<td align="left">6.44 (6.21-6.64)</td>
<td align="left">0.99 (0.95-1.04)</td>
</tr>
<tr class="even">
<td align="left">Only radiographic</td>
<td align="right">3150</td>
<td align="right">3274</td>
<td align="right">1106</td>
<td align="right">25.3</td>
<td align="left">6.47 (6.24-6.67)</td>
<td align="left">0.99 (0.95-1.03)</td>
</tr>
<tr class="odd">
<td align="left">Impute progression</td>
<td align="right">2678</td>
<td align="right">3924</td>
<td align="right">928</td>
<td align="right">19.1</td>
<td align="left">4.7 (4.57-4.86)</td>
<td align="left">1.31 (1.26-1.37)</td>
</tr>
<tr class="even">
<td align="left">Censor at lot change</td>
<td align="right">3880</td>
<td align="right">2701</td>
<td align="right">949</td>
<td align="right">26.0</td>
<td align="left">6.37 (6.18-6.6)</td>
<td align="left">0.99 (0.95-1.04)</td>
</tr>
<tr class="odd">
<td align="left">Ignore visit gaps</td>
<td align="right">2490</td>
<td align="right">3925</td>
<td align="right">1115</td>
<td align="right">22.1</td>
<td align="left">6.67 (6.44-6.93)</td>
<td align="left">0.93 (0.89-0.97)</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>The obtained table gives an overview across the rwPFS definitions we’re considering. It compares the no. of patients censored, with progression, or dying, as well as the percentage of rwPFS events (death and progression combined) that are death.</p>
<p>Kaplan-Meier median and hazard ratio relative to the reference definition give an impression of how big the impact on corresponding analysis outcomes would be. Note that to obtain the hazard ratio, a cox regression was fitted to data of twice the same patients but with different endpoints. Since the Cox model assumes the data from two compared groups to be independent, this is a bit of a stretch. The HR should therefore cautiously be interpreted as a crude indication of expected impact on any HR analyses, in order to avoid doing full senstivity analyses with all rwPFS definitions.</p>
<p>Glancing at HR’s across all definitions, we find that in most cases, hazard ratios should be little affected by the exact rwPFS definition, with two exceptions: imputing progression increases the event rate considerably, and not ensuring continuous progression follow-up slightly reduces the event rate, presumably due to progression events going missing.</p>
<p>With ‘imputing progression’ having the strongest impact, arguing for this definition would require strong evidence that there is a substantial amount of missing information in the progression data, and that line-change would be a reliable indicator of progression. We consider this not to be the case and conclude that imputing progression at line change is not to be recommended.</p>
<p>Not ensuring continuous follow-up by not censoring patients at the start of any visit gap of 90d or longer decreases the event rate, which suggests that indeed the progression information in patients with long gaps is incomplete. Consequently, we consider it reasonable to censor patients at the start of any long gaps, as is done in the reference definition.</p>
<p>Apart from ‘Ignore visit gaps’ and ‘Impute progression,’ all tested definitions appear sensible and differ very little in terms of hazard ratios or median rwPFS.</p>
<p><br></p>
<p>A remaining question is how long the time window for capturing deaths should be, after the end of progression follow-up. We’ve chosen 30 days above, but mostly because that’s what <span class="citation">Mhatre (2021)</span> and <span class="citation">Ton (2021)</span> did.</p>
<p><br></p>
<p>There may not be one single “right” value for the size of this window. However, one way of verifying if a given value is sensible is to vary the length of this window and check how many additional deaths are captured when extending it. The idea here is that we want to capture most of the deaths that are correlated with the end of progression follow-up, meaning they happen shortly after. In addition, we want to keep the window as small as possible to avoid missing any progression events. A pragmatic choice may be made that reconciles these opposing objectives as well as possible.</p>
<p><br><br>
We can calculate rwPFS endpoints with varying window lengths as follows:</p>
<p><br></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">&lt;-</span> <span class="va">fk</span> <span class="op">%&gt;%</span>
  
  <span class="co">#removing all previous rwPFS columns</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_select.html">fi_select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"rwpfs"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>     
  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>,
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">0</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_0d_window"</span>                                   
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>,
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">10</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_10d_window"</span>                                   
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>,
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">20</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_20d_window"</span>                                   
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>,
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">30</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_30d_window"</span>                                   
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>,
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">40</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_40d_window"</span>                                   
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>,
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">50</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_50d_window"</span>                                   
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>,
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">60</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_60d_window"</span>                                   
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>,
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">70</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_70d_window"</span>                                   
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>,
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">80</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_80d_window"</span>                                   
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_calc_rwPFS.html">fi_calc_rwPFS</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,                          
    visit_gap_start_date <span class="op">=</span> <span class="st">"lastvisitbeforegap"</span>,           
    last_clinic_note_date <span class="op">=</span> <span class="st">"lastclinicnotedate_nopseudo"</span>,
    progression_date <span class="op">=</span> <span class="st">"progressiondate_nopseudo"</span>,         
    last_activity_date <span class="op">=</span> <span class="st">"lastactivitydate"</span>,               
    death_date <span class="op">=</span> <span class="st">"dateofdeath"</span>,
    death_window_days <span class="op">=</span> <span class="fl">90</span>,                                
    max_follow_up_days <span class="op">=</span> <span class="fl">1200</span>,                             
    label <span class="op">=</span> <span class="st">"_90d_window"</span>                                   
  <span class="op">)</span> 
<span class="co">#&gt; Time    : 0s [80.1 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 0d after end of progression follow-up. Label: _0d_window.</span>
<span class="co">#&gt; NewCols : rwpfs_0d_window_eof_date, rwpfs_0d_window_event_type, rwpfs_0d_window_date, rwpfs_0d_window_days, rwpfs_0d_window_event, rwpfs_0d_window_months</span>
<span class="co">#&gt; Time    : 0s [80.2 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 10d after end of progression follow-up. Label: _10d_window.</span>
<span class="co">#&gt; NewCols : rwpfs_10d_window_eof_date, rwpfs_10d_window_event_type, rwpfs_10d_window_date, rwpfs_10d_window_days, rwpfs_10d_window_event, rwpfs_10d_window_months</span>
<span class="co">#&gt; Time    : 0.1s [80.2 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 20d after end of progression follow-up. Label: _20d_window.</span>
<span class="co">#&gt; NewCols : rwpfs_20d_window_eof_date, rwpfs_20d_window_event_type, rwpfs_20d_window_date, rwpfs_20d_window_days, rwpfs_20d_window_event, rwpfs_20d_window_months</span>
<span class="co">#&gt; Time    : 0s [80.3 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 30d after end of progression follow-up. Label: _30d_window.</span>
<span class="co">#&gt; NewCols : rwpfs_30d_window_eof_date, rwpfs_30d_window_event_type, rwpfs_30d_window_date, rwpfs_30d_window_days, rwpfs_30d_window_event, rwpfs_30d_window_months</span>
<span class="co">#&gt; Time    : 0s [80.3 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 40d after end of progression follow-up. Label: _40d_window.</span>
<span class="co">#&gt; NewCols : rwpfs_40d_window_eof_date, rwpfs_40d_window_event_type, rwpfs_40d_window_date, rwpfs_40d_window_days, rwpfs_40d_window_event, rwpfs_40d_window_months</span>
<span class="co">#&gt; Time    : 0s [80.4 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 50d after end of progression follow-up. Label: _50d_window.</span>
<span class="co">#&gt; NewCols : rwpfs_50d_window_eof_date, rwpfs_50d_window_event_type, rwpfs_50d_window_date, rwpfs_50d_window_days, rwpfs_50d_window_event, rwpfs_50d_window_months</span>
<span class="co">#&gt; Time    : 0s [80.4 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 60d after end of progression follow-up. Label: _60d_window.</span>
<span class="co">#&gt; NewCols : rwpfs_60d_window_eof_date, rwpfs_60d_window_event_type, rwpfs_60d_window_date, rwpfs_60d_window_days, rwpfs_60d_window_event, rwpfs_60d_window_months</span>
<span class="co">#&gt; Time    : 0.5s [80.9 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 70d after end of progression follow-up. Label: _70d_window.</span>
<span class="co">#&gt; NewCols : rwpfs_70d_window_eof_date, rwpfs_70d_window_event_type, rwpfs_70d_window_date, rwpfs_70d_window_days, rwpfs_70d_window_event, rwpfs_70d_window_months</span>
<span class="co">#&gt; Time    : 0s [80.9 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 80d after end of progression follow-up. Label: _80d_window.</span>
<span class="co">#&gt; NewCols : rwpfs_80d_window_eof_date, rwpfs_80d_window_event_type, rwpfs_80d_window_date, rwpfs_80d_window_days, rwpfs_80d_window_event, rwpfs_80d_window_months</span>
<span class="co">#&gt; Time    : 0s [81 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_rwPFS() ──────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first rwPFS event after lot1startdate, including death events occurring up to 90d after end of progression follow-up. Label: _90d_window.</span>
<span class="co">#&gt; NewCols : rwpfs_90d_window_eof_date, rwpfs_90d_window_event_type, rwpfs_90d_window_date, rwpfs_90d_window_days, rwpfs_90d_window_event, rwpfs_90d_window_months</span>
<span class="co">#&gt; Time    : 0s [81 s]</span></code></pre></div>
<p><br></p>
<p>and then compare them like before, but this time adding an ‘incremental deaths’ column to the output, indicating how many additional deaths are captured by extending the window by 10 more days</p>
<p><br></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_compare_rwPFS.html">fi_compare_rwPFS</a></span><span class="op">(</span>
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">9</span><span class="op">*</span><span class="fl">10</span>, <span class="st">"d_window"</span><span class="op">)</span>,                         <span class="co">#Specify the rwPFS labels to be tabulated (in the desired order)</span>
    reference <span class="op">=</span> <span class="st">"_30d_window"</span>,
    incremental_deaths_column <span class="op">=</span> <span class="cn">TRUE</span> 
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_compare_rwpfs() ──────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Comparing rwPFS definitions with the following labels: _0d_window, _10d_window, _20d_window, _30d_window, _40d_window, _50d_window, _60d_window, _70d_window, _80d_window, _90d_window</span></code></pre></div>
<table class="table">
<colgroup>
<col width="15%">
<col width="8%">
<col width="10%">
<col width="5%">
<col width="16%">
<col width="12%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">rwPFS definition</th>
<th align="right">Censoring</th>
<th align="right">Progression</th>
<th align="right">Death</th>
<th align="right">Incremental deaths</th>
<th align="right">Percent death</th>
<th align="left">KM median</th>
<th align="left">Hazard ratio</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0d window</td>
<td align="right">4023</td>
<td align="right">3343</td>
<td align="right">164</td>
<td align="right">NA</td>
<td align="right">4.7</td>
<td align="left">7.66 (7.46-7.95)</td>
<td align="left">0.8 (0.77-0.84)</td>
</tr>
<tr class="even">
<td align="left">10d window</td>
<td align="right">3747</td>
<td align="right">3343</td>
<td align="right">440</td>
<td align="right">276</td>
<td align="right">11.6</td>
<td align="left">7.29 (7.06-7.49)</td>
<td align="left">0.86 (0.83-0.9)</td>
</tr>
<tr class="odd">
<td align="left">20d window</td>
<td align="right">3407</td>
<td align="right">3343</td>
<td align="right">780</td>
<td align="right">340</td>
<td align="right">18.9</td>
<td align="left">6.8 (6.57-7.03)</td>
<td align="left">0.94 (0.9-0.98)</td>
</tr>
<tr class="even">
<td align="left">30d window</td>
<td align="right">3114</td>
<td align="right">3343</td>
<td align="right">1073</td>
<td align="right">293</td>
<td align="right">24.3</td>
<td align="left">6.41 (6.18-6.6)</td>
<td align="left">1 (reference)</td>
</tr>
<tr class="odd">
<td align="left">40d window</td>
<td align="right">2911</td>
<td align="right">3343</td>
<td align="right">1276</td>
<td align="right">203</td>
<td align="right">27.6</td>
<td align="left">6.18 (5.98-6.34)</td>
<td align="left">1.04 (1-1.08)</td>
</tr>
<tr class="even">
<td align="left">50d window</td>
<td align="right">2769</td>
<td align="right">3343</td>
<td align="right">1418</td>
<td align="right">142</td>
<td align="right">29.8</td>
<td align="left">6.01 (5.85-6.18)</td>
<td align="left">1.07 (1.02-1.11)</td>
</tr>
<tr class="odd">
<td align="left">60d window</td>
<td align="right">2667</td>
<td align="right">3343</td>
<td align="right">1520</td>
<td align="right">102</td>
<td align="right">31.3</td>
<td align="left">5.95 (5.75-6.11)</td>
<td align="left">1.08 (1.04-1.13)</td>
</tr>
<tr class="even">
<td align="left">70d window</td>
<td align="right">2597</td>
<td align="right">3343</td>
<td align="right">1590</td>
<td align="right">70</td>
<td align="right">32.2</td>
<td align="left">5.88 (5.68-6.05)</td>
<td align="left">1.09 (1.05-1.14)</td>
</tr>
<tr class="odd">
<td align="left">80d window</td>
<td align="right">2531</td>
<td align="right">3343</td>
<td align="right">1656</td>
<td align="right">66</td>
<td align="right">33.1</td>
<td align="left">5.82 (5.62-6.01)</td>
<td align="left">1.11 (1.06-1.15)</td>
</tr>
<tr class="even">
<td align="left">90d window</td>
<td align="right">2485</td>
<td align="right">3343</td>
<td align="right">1702</td>
<td align="right">46</td>
<td align="right">33.7</td>
<td align="left">5.78 (5.59-5.98)</td>
<td align="left">1.11 (1.07-1.16)</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>Similarly as before, we are now able to compare different rwPFS definitions at a glance and examine the impact of extending the time window for capturing death events.</p>
<p><br></p>
<p>First, a time-window of 0 days corresponds to a reasonably substantial HR difference of 0.2 compared to the reference (30d window). This indicates that indeed it is important to capture death events occuring after end of progression follow-up. We can also see, that the effect of extending the window from 30d to 90d changes the HR by 0.11, suggesting that the effect of extending the window further is diminishing rapidly. This is reflected in the ‘Incremental deaths’ column as well: for the each 10-day period up to 30 days we capture approximately 300 more deaths, with this number dropping rapidly thereafter. It is hard to tell where exactly the cutoff should be made - but it looks like 30d to 60d is reasonable since most censoring-related deaths appear to be captured, and further extension has negligible impact on hazard ratios.</p>
<p><br></p>
</div>
<div id="rwpfs-in-cancers-other-than-ansclc-and-custom-filtering-of-progression-events" class="section level1">
<h1 class="hasAnchor">
<a href="#rwpfs-in-cancers-other-than-ansclc-and-custom-filtering-of-progression-events" class="anchor"></a>rwPFS in cancers other than aNSCLC, and custom filtering of progression events</h1>
<p><br></p>
<p>The above examples all used the aNSCLC datamart - how can rwPFS be calculated for other datamarts?</p>
<p><br></p>
<p>There are three points to consider:</p>
<ul>
<li><p><code>fi_calc_rwPFS</code> and <code>fi_compare_rwPFS</code> can be used in exactly the same way as illustrated above.</p></li>
<li><p>Which rwPFS definitions are most appropriate must be determined individually for other patient populations.</p></li>
<li><p><code>fi_add_progression</code> makes assumptions about the structure of the <code>PROGRESSION</code> table in the Flatiron database, which may complicate its use with certain datamarts. However, the function can be tweaked by using the <code>prog_filter_expression</code> argument. With it, a logical R expression (involving unquoted table column names) can be supplied, and only progression events are included where this expression evaluates to “TRUE.” This can also be used for more fine-grained filtering of progression events in the aNSCLC datamart.</p></li>
</ul>
<p><br></p>
<p>For a start, let’s look what the <code>PROGRESSION</code> table looks like in the aNSCLC datamart</p>
<p><br></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_read_table.html">fi_read_table</a></span><span class="op">(</span>
    table_name <span class="op">=</span> <span class="st">"ENHANCED_ADVNSCLCPROGRESSION"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> 
<span class="co">#&gt; # Source:   lazy query [?? x 8]</span>
<span class="co">#&gt; # Database: postgres</span>
<span class="co">#&gt; #   [bretscm2@redshift-01-eu.dap.apollo.roche.com:5439/flatiron_edm]</span>
<span class="co">#&gt;   patientid progressiondate isradiographice… ispathologicevi… isclinicalasses…</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;date&gt;          &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;           </span>
<span class="co">#&gt; 1 F040824F… 2017-07-06      Yes              No               No              </span>
<span class="co">#&gt; 2 F040824F… 2017-09-11      Yes              No               No              </span>
<span class="co">#&gt; 3 F04086BF… 2012-10-04      Yes              Yes              No              </span>
<span class="co">#&gt; 4 F04086BF… 2013-02-25      Yes              No               No              </span>
<span class="co">#&gt; 5 F04086BF… 2013-11-06      Yes              No               No              </span>
<span class="co">#&gt; 6 F04086BF… 2014-02-13      Yes              No               No              </span>
<span class="co">#&gt; # … with 3 more variables: ismixedresponse &lt;chr&gt;,</span>
<span class="co">#&gt; #   ispseudoprogressionmentioned &lt;chr&gt;, lastclinicnotedate &lt;date&gt;</span></code></pre></div>
<p><br></p>
<p>Knowing the structure of the progression table, we can now select radiographically confirmed progression events that are not pseudoprogression using the <code>prog_filter_expression</code> argument - which yields the same result as what we get by using the <code>require_radiographic</code> and <code>exclude_pseudoprogression</code> arguments.</p>
<p><br></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk</span> <span class="op">&lt;-</span> <span class="va">fk</span> <span class="op">%&gt;%</span>
  <span class="co">#remove previously generated columns</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_select.html">fi_select</a></span><span class="op">(</span> 
    <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"progressiondate"</span><span class="op">)</span>, 
    <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"lastclinicnotedate"</span><span class="op">)</span>, 
    <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"rwpfs"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co">#This is how we filtered progression events before</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_add_progression.html">fi_add_progression</a></span><span class="op">(</span>
      start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,          
      require_radiographic <span class="op">=</span> <span class="cn">TRUE</span>,          
      exclude_pseudoprogression <span class="op">=</span> <span class="cn">TRUE</span>,      
      discard_n_days <span class="op">=</span> <span class="fl">0</span>,                   
      label <span class="op">=</span> <span class="st">"_radio_nopseudo"</span>,                  
      prog_filter_expression <span class="op">=</span> <span class="cn">NULL</span>          
  <span class="op">)</span> <span class="op">%&gt;%</span>
  
  
  <span class="co">#This is the same using prog_filter_expression instead</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_add_progression.html">fi_add_progression</a></span><span class="op">(</span>
      start_date <span class="op">=</span> <span class="st">"lot1startdate"</span>,          
      require_radiographic <span class="op">=</span> <span class="cn">FALSE</span>,          <span class="co">#These are now not used      </span>
      exclude_pseudoprogression <span class="op">=</span> <span class="cn">FALSE</span>,     <span class="co">#These are now not used</span>
      discard_n_days <span class="op">=</span> <span class="fl">0</span>,                   
      label <span class="op">=</span> <span class="st">"_prog_filter_expression"</span>,                  
      prog_filter_expression <span class="op">=</span> <span class="st">"isradiographicevidence == 'Yes' &amp;  ispseudoprogressionmentioned == 'No'"</span>     
  <span class="op">)</span>
<span class="co">#&gt; Time    : 0s [81 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_progression() ────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first progression event after lot1startdate, discarding events within the first 0 days. Require_radiographic: TRUE. Exclude_pseudoprogression: TRUE. Label: "_radio_nopseudo". Expression for additional filtering of progression events: none.</span>
<span class="co">#&gt; Touching: ENHANCED_ADVNSCLCPROGRESSION</span>
<span class="co">#&gt; Joining, by = "patientid"</span>
<span class="co">#&gt; NewCols : progressiondate_radio_nopseudo, lastclinicnotedate_radio_nopseudo</span>
<span class="co">#&gt; Time    : 7s [88 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_progression() ────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first progression event after lot1startdate, discarding events within the first 0 days. Require_radiographic: FALSE. Exclude_pseudoprogression: FALSE. Label: "_prog_filter_expression". Expression for additional filtering of progression events: "isradiographicevidence == 'Yes' &amp;  ispseudoprogressionmentioned == 'No'"</span>
<span class="co">#&gt; Touching: ENHANCED_ADVNSCLCPROGRESSION</span>
<span class="co">#&gt; Joining, by = "patientid"</span>
<span class="co">#&gt; NewCols : progressiondate_prog_filter_expression, lastclinicnotedate_prog_filter_expression</span>
<span class="co">#&gt; Time    : 7.3s [95.3 s]</span>
  
  <span class="co">#This is to demonstrate that the two ways are exactly equivalent</span>
  <span class="va">fk</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_pull_data.html">fi_pull_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">progressiondate_radio_nopseudo</span> <span class="op">==</span> <span class="va">.</span><span class="op">$</span><span class="va">progressiondate_prog_filter_expression</span><span class="op">)</span>
    <span class="op">}</span>
<span class="co">#&gt; [1] NA</span></code></pre></div>
<p><br><br>
As we can see, the two ways of filtering progression events are equivalent. <br></p>
<p>Note: require_radiographic or exclude_pseudoprogression arguments generate filter expressions that are simply concatenated with prog_filter_expression using logical <code>AND</code>.</p>
<p><br></p>
<p>To do this in Metastatic breastcancer, we run</p>
<p><br></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_start.html">fi_start</a></span><span class="op">(</span><span class="st">"MetastaticBreastCancer"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_connect() ────────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Connecting to database 'flatiron_edm' on server 'redshift-01-eu.dap.apollo.roche.com'</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_create() ─────────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : FlatironKitchen  v1.0.8 'Tiramisu'</span>
<span class="co">#&gt; Argument: title = 'bretscm2's 2021-06-29 MetastaticBreastCancer kitchen'</span>
<span class="co">#&gt; Note    : Using the latest Flatiron delivery: May-21</span>
<span class="co">#&gt; Argument: year_month = '2021_05'</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_cohort_start() ───────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Touching: ENHANCED_METASTATICBREAST</span>
<span class="co">#&gt; Warning : 906 (3.5%) patients appear in at least one other enhanced cohort.</span>
<span class="co">#&gt; Cohort  : 25,562 patients</span>
<span class="co">#&gt; NewCols : patientid, diagnosisdate, metdiagnosisdate, groupstage, multiple</span>
<span class="co">#&gt; Time    : 0.9s [0.9 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_demographics() ───────────────────────────────────────────────────── </span>
<span class="co">#&gt; Touching: DEMOGRAPHICS</span>
<span class="co">#&gt; NewCols : practiceid, practicetype, primaryphysicianid, birthyear, gender, race, ethnicity, state</span>
<span class="co">#&gt; Time    : 0.3s [1.2 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_calc_region() ────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Using State -&gt; Region mapping = 'phc'</span>
<span class="co">#&gt; NewCols : region</span>
<span class="co">#&gt; Time    : 0s [1.2 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_calc_raceethnicity() ─────────────────────────────────────────────────── </span>
<span class="co">#&gt; NewCols : raceethnicity</span>
<span class="co">#&gt; Time    : 0s [1.2 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_mortality() ──────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Argument: impute_method = '15'</span>
<span class="co">#&gt; Touching: ENHANCED_MORTALITY</span>
<span class="co">#&gt; Warning : 11 (0.1%) patient(s) had DateOfDeath values unlike YYYY-MM and will be set to missing</span>
<span class="co">#&gt; NewCols : dateofdeath</span>
<span class="co">#&gt; Time    : 0.3s [1.5 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_calc_death() ─────────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Argument: method = 'non_miss_dod'</span>
<span class="co">#&gt; NewCols : death</span>
<span class="co">#&gt; Time    : 0s [1.5 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_lastdates() ──────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Touching: VISIT</span>
<span class="co">#&gt; Touching: MEDICATIONADMINISTRATION</span>
<span class="co">#&gt; Touching: LAB</span>
<span class="co">#&gt; Touching: VITALS</span>
<span class="co">#&gt; NewCols : lastvisitdate, lastadmindate, lastlabdate, lastvitalsdate</span>
<span class="co">#&gt; Time    : 1.1s [2.6 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_calc_lastactivity_date() ─────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : lastactivitydate = max(lastvisitdate, lastadmindate, lastlabdate, lastvitalsdate, enddate)</span>
<span class="co">#&gt; NewCols : enddate, lastactivitydate</span>
<span class="co">#&gt; Time    : 0.3s [2.8 s]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_calc_lastcontact_date() ──────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : lastcontactdate = max(dateofdeath, lastvisitdate, lastadmindate, lastlabdate, lastvitalsdate)</span>
<span class="co">#&gt; NewCols : lastcontactdate</span>
<span class="co">#&gt; Time    : 0s [2.9 s]</span>

<span class="va">fk2</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_read_table.html">fi_read_table</a></span><span class="op">(</span>table_name <span class="op">=</span> <span class="st">"ENHANCED_METBREASTPROGRESSION"</span><span class="op">)</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> 
<span class="co">#&gt; # Source:   lazy query [?? x 10]</span>
<span class="co">#&gt; # Database: postgres</span>
<span class="co">#&gt; #   [bretscm2@redshift-01-eu.dap.apollo.roche.com:5439/flatiron_edm]</span>
<span class="co">#&gt;   patientid progressiondate isradiographice… ispathologicevi… isclinicalasses…</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;date&gt;          &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;           </span>
<span class="co">#&gt; 1 F0AAB4A3… 2021-01-25      Yes              No               No              </span>
<span class="co">#&gt; 2 F0AABEA1… 2016-03-03      Yes              No               No              </span>
<span class="co">#&gt; 3 F0AACBCA… 2020-01-22      Yes              No               No              </span>
<span class="co">#&gt; 4 F0AAF690… 2017-03-28      Yes              Yes              No              </span>
<span class="co">#&gt; 5 F0AAFF4E… 2017-09-29      Yes              Yes              No              </span>
<span class="co">#&gt; 6 F0AB2484… NA              &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;            </span>
<span class="co">#&gt; # … with 5 more variables: isphysicalexamevidence &lt;chr&gt;,</span>
<span class="co">#&gt; #   istumormarkersonly &lt;chr&gt;, ismixedresponse &lt;chr&gt;,</span>
<span class="co">#&gt; #   ispseudoprogressionmentioned &lt;chr&gt;, lastclinicnotedate &lt;date&gt;</span></code></pre></div>
<p><br></p>
<p>This progression table has additional columns/flags while containing the <code>ispseudoprogressionmentioned</code> and <code>isradiographicevidence</code> columns we’ve seen in the aNSCLC progression table. All these can be used jointly to filter progression events, for example</p>
<p><br></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fk2</span> <span class="op">&lt;-</span> <span class="va">fk2</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/FlatironKitchen/man/fi_add_progression.html">fi_add_progression</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="st">"metdiagnosisdate"</span>,
    require_radiographic <span class="op">=</span> <span class="cn">FALSE</span>,
    exclude_pseudoprogression <span class="op">=</span> <span class="cn">TRUE</span>,
    discard_n_days <span class="op">=</span> <span class="fl">0</span>,
    label <span class="op">=</span> <span class="st">""</span>,
    prog_filter_expression <span class="op">=</span> <span class="st">"istumormarkersonly == 'No'"</span>
  <span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── fi_add_progression() ────────────────────────────────────────────────────── </span>
<span class="co">#&gt; Note    : Adding first progression event after metdiagnosisdate, discarding events within the first 0 days. Require_radiographic: FALSE. Exclude_pseudoprogression: TRUE. Label: none. Expression for additional filtering of progression events: "istumormarkersonly == 'No'"</span>
<span class="co">#&gt; Touching: ENHANCED_METBREASTPROGRESSION</span>
<span class="co">#&gt; Joining, by = "patientid"</span>
<span class="co">#&gt; Warning : 3097 patient(s) had no progression information abstracted beyond startdate (lastclinicnotedate set to missing)</span>
<span class="co">#&gt; NewCols : progressiondate, lastclinicnotedate</span>
<span class="co">#&gt; Time    : 27.2s [30.1 s]</span></code></pre></div>
<p><br></p>
<p>In this manner we can use <code>fi_add_progression</code> with any progression table that has a <code>progressiondate</code> and a <code>lastclinicnotedate</code> column.</p>
<p><br></p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-rwPFS_OAK" class="csl-entry">
Mhatre. 2021. <span>“Replicating Progression-Free Survival in the OAK Trial Using Real-World Data.”</span> <em>In Preparation</em>.
</div>
<div id="ref-EC_impowers" class="csl-entry">
Ton. 2021. <span>“Replication of Overall Survival, Progression Free Survival and Response in Chemotherapy Arms of First Line Non-Small Cell Lung Cancer Trials Using Real-World Data External Controls.”</span> <em>In Preparation</em>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael Bretscher, Shanmugasundaram Prabhu, Nandi Kalyan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
